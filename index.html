<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Welcome to Kenta & Mariko Bridal</title>
	<link rel="stylesheet" href="index.css">
</head>
<body class="double">

<div id="top_logo">
	<img src="./KentaMarikoBridalLogo1.png" width="100%"/>
</div>

<!-- çµå©šå¼ç¿Œæ—¥ã«æœ‰åŠ¹åŒ–ã™ã‚‹ã‚¢ãƒ«ãƒãƒ 
<a href="https://photos.app.goo.gl/NdoDAPi37TYJEzdh7">ã‚¢ãƒ«ãƒãƒ ã¸ã®ãƒªãƒ³ã‚¯</a>
-->

<!--<p id="welcome"></p>-->
<div id="welcome">
	<img id="welcome_gif" src="./kenta_Welcome.gif"  width="100%"/>
</div>


<style>
	/* ãƒãƒ£ãƒƒãƒˆç”»é¢ã‚’å›²ã‚€divè¦ç´ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #konnect-container {
      //opacity: 0; // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¸€ç¬è¡¨ç¤ºã•ã‚Œã‚‹å°çª“ã‚’æŠ‘æ­¢ã™ã‚‹ãŸã‚ 
      right: 5px;
      bottom: 40px; // !importantç„¡æŒ‡å®š  
      width: 498px!important; /* æ¨ªå¹…500ã‹ã‚‰å·¦å³borderåˆ†2pxãƒã‚¤ãƒŠã‚¹ */
      max-height: calc(100% - 40px)!important; // ç”»é¢é«˜ã• - ä¸‹éƒ¨ãƒœã‚¿ãƒ³é«˜ã• - ç”»é¢ä¸Šéƒ¨ã¨ã®ä½™ç™½
    }
    
    
    /* ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³Gifã®divè¦ç´  */
    #welcome {
	    //display: none;
	    position: fixed;
	    z-index: 100000;
	    width: calc(100% - 10px)!important;
		bottom: 5px;
		right: 5px;
		//height:330px;
		//width:30%;
		//height:30%;
		//
		//min-width: 385px; 
		//min-height: 82px; 
		//margin: 0;
		//background: url("./kenta_Welcome.gif") left top no-repeat;
		//background-position: right;
		//background-size: 375px 667px; 
		//background-repeat: no-repeat;
		cursor:pointer;
    }
    
    // ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³gifã®imgè¦ç´ 
	#welcome_gif{
		width: 100%!important;
    	margin-left: 10px;
    	margin-right:10px;
	}
	
	
    /* ç”»é¢ä¸‹éƒ¨ã®ãƒœã‚¿ãƒ³è¡¨ç¤ºéƒ¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #custom_btn_container {
      position: fixed;
      right: 5px;
      bottom: 0px;
      z-index: 99998; /* div#konnect-containerã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å€¤ã¨åŒã˜å€¤ã‚’æŒ‡å®š */
      max-width: 498px!important; /* æ¨ªå¹…500ã‹ã‚‰å·¦å³borderåˆ†2pxãƒã‚¤ãƒŠã‚¹ */
      //width:498px;
      width: calc(100% - 12px);
	  height: 40px;
      border: 1px solid #DDDDDD;
      background-color: #EDF8E4;
      font-family: "Yu Gothic Medium", YuGothic, sans-serif;
      line-height: 40px;
    }
    /* ç”»é¢ä¸‹éƒ¨ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .square_btn1,.square_btn2,.square_btn3,.square_btn4{
      display: inline-block;
      margin: 3px;
      //padding: .3em 1em;
      border-radius: 3px;
      box-sizing: border-box;
      color: #fff;
      font-size: 12px;
      line-height: 1.5;
      text-decoration: none;
      text-align: center;
      vertical-align: middle;
      transition: .4s;
    }.square_btn1:hover,.square_btn2:hover,.square_btn3:hover {
      background: #e28500;
    }
    	.square_btn1 {
		width: calc(25% - 4px);
		background: #2cbb23;
	}
	
	.square_btn2 {
		width: calc(25% - 4px);
		background: rgb(143,170,220);
	}
	.square_btn3 {
		width: calc(22% - 4px );
		background: #2cbb23;
	}
	.square_btn4 {
		width: calc(25% - 4px );
		background: rgb(255,201,255);
		color: rgb(51,51,51);
    	font-weight: bold
	}
	
	#mbaGuestFrame_content_input_wrapper_textarea > span {
		 display: none !important;
	}
	
	.mbaGuestFrame_content_timeline_list_message_avatar {
	    width: 60px!important;
	    border: 2px solid #48a24e!important;
	    border-radius: 20%!important!important;
	}
	
</style>
	
	
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script type="text/javascript" src="https://agent.chordship.global.fujitsu.com/assets/script/embed/current/mobi-agent-client-frame-loader.min.js"></script>

	
<script>
	
	'use strict';
	
	function countupCounter() {

            let target = `https://kentamarikohappywedding.azurewebsites.net/good`;
            $.ajax({
                url: target,
                data: 'json'
            })
            .done((res) => {
                console.log(res);
                
                var goodCount=res.good_count + '';
                
                $('#btn1').html("ğŸ‰ãŠã‚ã§ã¨ã†ï¼<br>"+ goodCount.substr(-4) + "å›");
                
            });
	};
	
	function getCounter() {


            let target = `https://kentamarikohappywedding.azurewebsites.net/get`;
           
            $.ajax({
                url: target,
                data: 'json'
            })
            .done((res) => {
                console.log(res);
                
                var goodCount=res.good_count + '';
                
                $('#btn1').html("ğŸ‰ãŠã‚ã§ã¨ã†ï¼<br>"+ goodCount.substr(-4) + "å›");
                
            });
	};
	
	 function showChatWindow() {
	      // å°çª“ã®åˆ¶å¾¡
	     $('#konnect-container').css({
	        'visibility': 'visible',
	        'opacity': '1.0',
	        'top': 'auto',
	        'bottom': ''
	      });
	      // ä¸‹éƒ¨ãƒœã‚¿ãƒ³ã®åˆ¶å¾¡
	      $('#custom_btn_container').show();
	      // é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®åˆ¶å¾¡
	      setTimeout(function() {
	        $('#close_btn').css('display', 'block');
	      }, 500);
	      // ãƒãƒŠãƒ¼ã‚’é–‰ã˜ã‚‹
	      //$('#mobileBanner').fadeOut('normal');
		 
		
    };
    
    // ãƒãƒ£ãƒƒãƒˆç”»é¢ã‚’éš ã™å‡¦ç†
     function hideChatWindow() {
		// ä¸‹éƒ¨ãƒœã‚¿ãƒ³ã®åˆ¶å¾¡
		$('#custom_btn_container').fadeOut(500);
		// é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®åˆ¶å¾¡
		$('#close_btn').css('display', 'none');
		// å°çª“ã®åˆ¶å¾¡
		$('#konnect-container').animate({
		'opacity': '0'
		},{
		duration: 500,
		queue: false,
		complete: function() { // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
		  $('#konnect-container').css({
		    'visibility': 'hidden',
		    'top': 'auto',
		    //'top': '200px',
		    //'bottom': '-' + $('#konnect-container').height() + 'px'
		    'bottom': ''
		  });
		  // ãƒãƒŠãƒ¼è¡¨ç¤º
		  $('#mobileBanner').fadeIn('normal');
		}
		});
    };
	// welcomeç”»åƒã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã®å‡¦ç†
	$('#welcome').on('click', function(){
		$('#welcome').css({
		    //'visibility': 'hidden',
		    'z-index':1,
		    'opacity': '0.0',
		    'transition' : 'opacity 1s linear 0s'
		});
		startChat();
		MobiAgentClient.toggle(true);
	});
	var startChat = function() {
	    var domainId = $('#domain-id').val();
	    localStorage.setItem('domain-id', domainId);
		
		
	    MobiAgentClient.init(
    		'https://agent.chordship.global.fujitsu.com', // server url
    		'fujitsudemo02',
			{
		        useMarkDownSyntax: true,
		        allowFileUpload: false,
		        skipDomainStatusCheck: true,
		        listenVisiblityChange: false,
		        showAvatar: true,
		        location: "KentaMarikoBridal"
			}, // options
			function(){
				// ãƒãƒ£ãƒƒãƒˆç”»é¢ã®èª­ã¿è¾¼ã¿å¾Œã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ãƒœã‚¿ãƒ³ã‚’appendã™ã‚‹
			    $('#konnect-container').after('<div id="custom_btn_container" style="display:none"></div>');
			    $('#custom_btn_container').append('<a href="#" id="btn1" class="square_btn1">ãŠã‚ã§ã¨ã†</a>');
			    //$('#custom_btn_container').append('<a href="#" id="good_count" class="counter"></a>');
			    $('#custom_btn_container').append('<a href="#" id="btn2" class="square_btn2">æ–°éƒã«<br>è³ªå•ã™ã‚‹</a>');
			    $('#custom_btn_container').append('<a href="#" id="btn4" class="square_btn4">ğŸ‘—æ–°å©¦ã«<br>è³ªå•ã™ã‚‹</a>');
			    $('#custom_btn_container').append('<a href="#" id="btn3" class="square_btn3">ğŸ‘äºŒäººã¸<br>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</a>');
			    
			    // ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸéš›ã®å‡¦ç†
			    $('#btn1').on('click', function(){
			    	countupCounter();
			    });
			    $('#btn2').on('click', function(){
			    	MobiAgentClient.sendMessage('[JumpKenta]','');
			    });
			    $('#btn3').on('click', function(){
			    	MobiAgentClient.sendMessage('[æ–°éƒæ–°å©¦ã¸ã®ã‚³ãƒ¡ãƒ³ãƒˆ]','');
			    });
				$('#btn4').on('click', function(){
			    	MobiAgentClient.sendMessage('[JumpMariko]','');
			    });
				
				
				getCounter();
			    
			});
			
	};
	
	
		 // åˆå›å°çª“ã‚ªãƒ¼ãƒ—ãƒ³æ™‚ã‹ã©ã†ã‹ã‚’åˆ¤å®š
    var hasRoom = false; // ãƒ«ãƒ¼ãƒ ãŒã™ã§ã«å­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹
    var sendMsg = false; // åˆå›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚ŒãŸã‹ã©ã†ã‹
    // å°çª“ç”»é¢ãƒ­ãƒ¼ãƒ‰æ™‚ã«å‘¼ã°ã‚Œã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ
    MobiAgentClient.on('sdkReady', function(data){
      MobiAgentClient.on('roomReady', function(data){
      	MobiAgentClient.toggle(true);
      });
	    
      // å°çª“ã®ã¿ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹å ´åˆ
      if(hasRoom && sendMsg){
      	//showChatWindow()
        hasRoom = false;
        sendMsg = false;
      }
      else {
        //hideChatWindow();
      }
      // ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ãŸå ´åˆ
      if (data.hasRoom){
        hasRoom = true;
        sendMsg = false;
      }
    });
		
	
	// ãƒãƒ£ãƒƒãƒˆå°çª“ã®Openæ™‚ã®å‡¦ç†
	// åˆã‚ã«ï¼‘ãƒãƒ£ãƒƒãƒˆé€ä¿¡ã—ãªã„ã¨ã€ã‚«ãƒ†ã‚´ãƒªé¸æŠãŒè¡¨ç¤ºã•ã‚Œãªã„ãŸã‚
	MobiAgentClient.on('openFrame', function(data2){
		
      	showChatWindow();
      	// åˆå›Openæ™‚ã«é€ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      	if(hasRoom == false || (hasRoom == true && sendMsg == false)){
        	MobiAgentClient.sendMessage('[ãƒãƒ£ãƒƒãƒˆé–‹å§‹]','');
        	hasRoom = true;
        	sendMsg = true;
      	}
		 });
		 
		 // ãƒãƒ£ãƒƒãƒˆå°çª“ã®Closeæ™‚ã®å‡¦ç†
	MobiAgentClient.on('closeFrame', function(data2){
  		hideChatWindow();
		
		$('#welcome').css({
		    //'visibility': 'visible',
		    'z-index':100000,
		    'opacity': '1.0',
		    'transition' : 'opacity 1s linear 0s'
		});
	});
	
	/*
	$(function(){
      $('#domain-id').val(localStorage.getItem('domain-id'));
      MobiAgentClient.on('sdkReady', function(data){
        MobiAgentClient.on('roomReady', function(data){
          MobiAgentClient.toggle();
        });
        if (!data.hasRoom){
          MobiAgentClient.sendMessage('[ãƒãƒ£ãƒƒãƒˆé–‹å§‹]');
        }
      });
      MobiAgentClient.on('closeChatView', function(data){
        location.reload(true);
      });
    });	*/
    
	function closeRoom(){
	    setTimeout(() => {
	      MobiAgentClient.setReviewThenClose(5, 'ãƒ«ãƒ¼ãƒ ã‚¯ãƒ­ãƒ¼ã‚º');
	      setTimeout(() => {
	        MobiAgentClient.loadOnceGuard=false;
	        //hideChatWindow();
	        //MobiAgentClient.toggle(false);
	      }, 0)
	    }, 0);
	}
	
	var removeMobiContainer = function(){
		$("#konnect-container").remove();
		$("#custom_btn_container").remove();
		console.log("remove mobi container");
  	};
  	
	var closeSessionAndInitMobi = function(){
		setTimeout(() => {
			closeRoom();
			setTimeout(() => {
				MobiAgentClient.toggle(false);
				removeMobiContainer();
				setTimeout(() => {
					startChat();
				}, 500)
			}, 500)
		}, 0);
	};
	
    
</script>

</body>
</html>